"""
ê³„ì¸µì  ì§€ì—­ ì¶”ì¶œê¸° (Hierarchical Location Extractor)

ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ì—ì„œ ì‹œ > êµ¬ > ë™ > POI ê³„ì¸µ êµ¬ì¡°ë¥¼ ì¶”ì¶œí•˜ì—¬
ì§€ì—­ íŠ¹ì •ì„±ì„ ìµœëŒ€í•œ ë³´ì¡´í•©ë‹ˆë‹¤.
"""

from typing import Dict, Any, List, Tuple, Optional
import re


class HierarchicalLocationExtractor:
    """í”„ë¡¬í”„íŠ¸ì—ì„œ ê³„ì¸µì  ì§€ì—­ ì •ë³´ ì¶”ì¶œ"""
    
    # í•œêµ­ ì£¼ìš” ë„ì‹œ í–‰ì •êµ¬ì—­ ë°ì´í„°
    KOREAN_LOCATIONS = {
        'ì„œìš¸': {
            'ê°•ì„œêµ¬': ['ë§ˆê³¡ë™', 'ë“±ì´Œë™', 'í™”ê³¡ë™', 'ê°€ì–‘ë™', 'ì—¼ì°½ë™', 'ë°©í™”ë™', 'ê³µí•­ë™'],
            'ê°•ë‚¨êµ¬': ['ì—­ì‚¼ë™', 'ì‚¼ì„±ë™', 'ì²­ë‹´ë™', 'ëŒ€ì¹˜ë™', 'ì‹ ì‚¬ë™', 'ë…¼í˜„ë™', 'ì••êµ¬ì •ë™', 'ê°œí¬ë™', 'ì„¸ê³¡ë™', 'ì¼ì›ë™'],
            'ì¢…ë¡œêµ¬': ['ì¢…ë¡œ1ê°€', 'ì¢…ë¡œ2ê°€', 'ì¢…ë¡œ3ê°€', 'ì¢…ë¡œ4ê°€', 'ì‚¬ì§ë™', 'ì‚¼ì²­ë™', 'í‰ì°½ë™', 'ë¶€ì•”ë™', 'êµë‚¨ë™'],
            'ì¤‘êµ¬': ['ëª…ë™', 'ë‚¨ëŒ€ë¬¸ë¡œ', 'ì†Œê³µë™', 'íšŒí˜„ë™', 'ë‚¨ì‚°ë™', 'í•„ë™', 'ì¥ì¶©ë™', 'ê´‘í¬ë™', 'ì„ì§€ë¡œ'],
            'ìš©ì‚°êµ¬': ['ì´íƒœì›ë™', 'í•œë‚¨ë™', 'í›„ì•”ë™', 'ìš©ì‚°ë™', 'ë‚¨ì˜ë™', 'ì²­íŒŒë™', 'ì›íš¨ë¡œ', 'íš¨ì°½ë™', 'ì„œë¹™ê³ ë™'],
            'ì„±ë™êµ¬': ['ì„±ìˆ˜ë™', 'ì™•ì‹­ë¦¬ë™', 'í–‰ë‹¹ë™', 'ê¸ˆí˜¸ë™', 'ì˜¥ìˆ˜ë™', 'ìƒì™•ì‹­ë¦¬ë™'],
            'ê´‘ì§„êµ¬': ['êµ¬ì˜ë™', 'ê´‘ì¥ë™', 'ì¤‘ê³¡ë™', 'ëŠ¥ë™', 'ìì–‘ë™', 'í™”ì–‘ë™'],
            'ë™ëŒ€ë¬¸êµ¬': ['íšŒê¸°ë™', 'íœ˜ê²½ë™', 'ì´ë¬¸ë™', 'ì „ë†ë™', 'ë‹µì‹­ë¦¬ë™', 'ì¥ì•ˆë™', 'ì²­ëŸ‰ë¦¬ë™'],
            'ì¤‘ë‘êµ¬': ['ë©´ëª©ë™', 'ìƒë´‰ë™', 'ì¤‘í™”ë™', 'ë¬µë™', 'ë§ìš°ë™', 'ì‹ ë‚´ë™'],
            'ì„±ë¶êµ¬': ['ì„±ë¶ë™', 'ëˆì•”ë™', 'ì•ˆì•”ë™', 'ë³´ë¬¸ë™', 'ì •ë¦‰ë™', 'ê¸¸ìŒë™', 'ì¢…ì•”ë™', 'ì›”ê³¡ë™', 'ì¥ìœ„ë™', 'ì„ê´€ë™'],
            'ê°•ë¶êµ¬': ['ë¯¸ì•„ë™', 'ë²ˆë™', 'ìˆ˜ìœ ë™', 'ìš°ì´ë™'],
            'ë„ë´‰êµ¬': ['ìŒë¬¸ë™', 'ë°©í•™ë™', 'ì°½ë™', 'ë„ë´‰ë™'],
            'ë…¸ì›êµ¬': ['ì›”ê³„ë™', 'ê³µë¦‰ë™', 'í•˜ê³„ë™', 'ìƒê³„ë™', 'ì¤‘ê³„ë™'],
            'ì€í‰êµ¬': ['ì‘ì•”ë™', 'ì—­ì´Œë™', 'ë¶ˆê´‘ë™', 'ë…¹ë²ˆë™', 'í™ì€ë™', 'ì‹ ì‚¬ë™', 'ì¦ì‚°ë™', 'ìˆ˜ìƒ‰ë™', 'êµ¬ì‚°ë™', 'ëŒ€ì¡°ë™'],
            'ì„œëŒ€ë¬¸êµ¬': ['ì¶©ì •ë¡œ', 'ì²œì—°ë™', 'ë¶ì•„í˜„ë™', 'ì‹ ì´Œë™', 'ì—°í¬ë™', 'í™ì œë™', 'í™ì€ë™'],
            'ë§ˆí¬êµ¬': ['ì•„í˜„ë™', 'ê³µë•ë™', 'ë„í™”ë™', 'ìš©ê°•ë™', 'ëŒ€í¥ë™', 'ì—¼ë¦¬ë™', 'ì‹ ìˆ˜ë™', 'ì„œê°•ë™', 'ì„œêµë™', 'í•©ì •ë™', 'ë§ì›ë™', 'ì—°ë‚¨ë™', 'ì„±ì‚°ë™', 'ìƒì•”ë™'],
            'ì–‘ì²œêµ¬': ['ì‹ ì •ë™', 'ëª©ë™', 'ì‹ ì›”ë™'],
            'êµ¬ë¡œêµ¬': ['êµ¬ë¡œë™', 'ê°€ë¦¬ë´‰ë™', 'ê³ ì²™ë™', 'ê°œë´‰ë™', 'ì˜¤ë¥˜ë™', 'ê¶ë™', 'ì˜¨ìˆ˜ë™', 'ì²œì™•ë™', 'í•­ë™'],
            'ê¸ˆì²œêµ¬': ['ê°€ì‚°ë™', 'ë…ì‚°ë™', 'ì‹œí¥ë™'],
            'ì˜ë“±í¬êµ¬': ['ì˜ë“±í¬ë™', 'ì—¬ì˜ë„ë™', 'ë‹¹ì‚°ë™', 'ë„ë¦¼ë™', 'ë¬¸ë˜ë™', 'ì–‘í‰ë™', 'ì‹ ê¸¸ë™', 'ëŒ€ë¦¼ë™'],
            'ë™ì‘êµ¬': ['ë…¸ëŸ‰ì§„ë™', 'ìƒë„ë™', 'í‘ì„ë™', 'ì‚¬ë‹¹ë™', 'ëŒ€ë°©ë™', 'ì‹ ëŒ€ë°©ë™'],
            'ê´€ì•…êµ¬': ['ë´‰ì²œë™', 'ì‹ ë¦¼ë™', 'ë‚¨í˜„ë™'],
            'ì„œì´ˆêµ¬': ['ì„œì´ˆë™', 'ì ì›ë™', 'ë°˜í¬ë™', 'ë°©ë°°ë™', 'ì–‘ì¬ë™', 'ë‚´ê³¡ë™'],
            'ê°•ë™êµ¬': ['ëª…ì¼ë™', 'ê³ ë•ë™', 'ìƒì¼ë™', 'ê¸¸ë™', 'ë‘”ì´Œë™', 'ì•”ì‚¬ë™', 'ì„±ë‚´ë™', 'ì²œí˜¸ë™', 'ê°•ì¼ë™'],
            'ì†¡íŒŒêµ¬': ['ì ì‹¤ë™', 'ì‹ ì²œë™', 'í’ë‚©ë™', 'ì†¡íŒŒë™', 'ì„ì´Œë™', 'ì‚¼ì „ë™', 'ê°€ë½ë™', 'ë¬¸ì •ë™', 'ì¥ì§€ë™', 'ë°©ì´ë™', 'ì˜¤ê¸ˆë™']
        },
        'ë¶€ì‚°': {
            'í•´ìš´ëŒ€êµ¬': ['ìš°ë™', 'ì¤‘ë™', 'ì†¡ì •ë™', 'ì¬ì†¡ë™', 'ë°˜ì—¬ë™', 'ì„ëŒ€ë™', 'ë°˜ì†¡ë™', 'ì¢Œë™'],
            'ìˆ˜ì˜êµ¬': ['ê´‘ì•ˆë™', 'ë‚¨ì²œë™', 'ìˆ˜ì˜ë™', 'ë§ë¯¸ë™', 'ë¯¼ë½ë™'],
            'ë™ë˜êµ¬': ['ëª…ë¥œë™', 'ì˜¨ì²œë™', 'ì‚¬ì§ë™', 'ì•ˆë½ë™', 'ëª…ì¥ë™', 'ë³µì²œë™'],
            'ë¶€ì‚°ì§„êµ¬': ['ë¶€ì „ë™', 'ë²”ì²œë™', 'ì—°ì§€ë™', 'ì´ˆìë™', 'ì–‘ì •ë™', 'ì „í¬ë™', 'ë¶€ì•”ë™', 'ë‹¹ê°ë™'],
            'ë‚¨êµ¬': ['ëŒ€ì—°ë™', 'ìš©í˜¸ë™', 'ìš©ë‹¹ë™', 'ê°ë§Œë™', 'ìš°ì•”ë™'],
            'ì¤‘êµ¬': ['ì¤‘ì•™ë™', 'ë™ê´‘ë™', 'ë‚¨í¬ë™', 'ì˜ì£¼ë™', 'ê´‘ë³µë™', 'ë¶€í‰ë™'],
            'ì„œêµ¬': ['ì„œëŒ€ì‹ ë™', 'ë™ëŒ€ì‹ ë™', 'ë¶€ë¯¼ë™', 'ì•„ë¯¸ë™', 'ì´ˆì¥ë™', 'ì¶©ë¬´ë™'],
            'ë™êµ¬': ['ì´ˆëŸ‰ë™', 'ìˆ˜ì •ë™', 'ì¢Œì²œë™', 'ë²”ì¼ë™', 'ë²”ì²œë™'],
            'ì˜ë„êµ¬': ['ë‚¨í•­ë™', 'ì˜ì„ ë™', 'ì‹ ì„ ë™', 'ë´‰ë˜ë™', 'ì²­í•™ë™', 'ë™ì‚¼ë™'],
            'ë¶êµ¬': ['êµ¬í¬ë™', 'ê¸ˆê³¡ë™', 'í™”ëª…ë™', 'ë•ì²œë™', 'ë§Œë•ë™'],
            'ì‚¬ìƒêµ¬': ['ì‚¼ë½ë™', 'ëª¨ë¼ë™', 'ë•í¬ë™', 'ê´˜ë²•ë™', 'ê°ì „ë™', 'ì£¼ë¡€ë™', 'í•™ì¥ë™'],
            'ì‚¬í•˜êµ¬': ['ê´´ì •ë™', 'ë‹¹ë¦¬ë™', 'í•˜ë‹¨ë™', 'ì‹ í‰ë™', 'ì¥ë¦¼ë™', 'ë‹¤ëŒ€ë™'],
            'ê¸ˆì •êµ¬': ['ê¸ˆì‚¬ë™', 'êµ¬ì„œë™', 'ì„œë™', 'ì„ ë™', 'ì²­ë£¡ë™', 'íšŒë™ë™', 'ì¥ì „ë™', 'ë‚¨ì‚°ë™'],
            'ê°•ì„œêµ¬': ['ëŒ€ì €ë™', 'ê°•ë™ë™', 'ëª…ì§€ë™', 'ë…¹ì‚°ë™', 'ì£½ë¦¼ë™', 'ì§€ì‚¬ë™'],
            'ì—°ì œêµ¬': ['ê±°ì œë™', 'ì—°ì‚°ë™'],
            'ê¸°ì¥êµ°': ['ê¸°ì¥ì', 'ì¥ì•ˆì', 'ì •ê´€ì', 'ì¼ê´‘ì', 'ì² ë§ˆë©´']
        },
        'ëŒ€êµ¬': {
            'ì¤‘êµ¬': ['ë™ì¸ë™', 'ì‚¼ë•ë™', 'ì„±ë‚´ë™', 'ëŒ€ì‹ ë™', 'ë‚¨ì‚°ë™', 'ëŒ€ë´‰ë™'],
            'ë™êµ¬': ['ì‹ ì•”ë™', 'ì‹ ì²œë™', 'íš¨ëª©ë™', 'ë„í‰ë™', 'ë¶ˆë¡œë™', 'ì§€ì €ë™'],
            'ì„œêµ¬': ['ë‚´ë‹¹ë™', 'ë¹„ì‚°ë™', 'í‰ë¦¬ë™', 'ìƒë¦¬ë™', 'ì›ëŒ€ë™'],
            'ë‚¨êµ¬': ['ëŒ€ëª…ë™', 'ë´‰ë•ë™', 'ì´ì²œë™'],
            'ë¶êµ¬': ['ì‚°ê²©ë™', 'ê²€ë‹¨ë™', 'ì¹¨ì‚°ë™', 'êµ¬ì•”ë™', 'ì¹ ì„±ë™', 'ë…¸ì›ë™'],
            'ìˆ˜ì„±êµ¬': ['ë²”ì–´ë™', 'ë§Œì´Œë™', 'ìˆ˜ì„±ë™', 'í™©ê¸ˆë™', 'ì¤‘ë™', 'ìƒë™', 'íŒŒë™', 'ë‘ì‚°ë™'],
            'ë‹¬ì„œêµ¬': ['ì„±ë‹¹ë™', 'ë‘ë¥˜ë™', 'ë³¸ë™', 'ì´ê³¡ë™', 'ì‹ ë‹¹ë™', 'ë³¸ë¦¬ë™', 'ì£½ì „ë™', 'ì¥ê¸°ë™', 'ìš©ì‚°ë™', 'ë„ì›ë™', 'ì›”ì„±ë™', 'ì§„ì²œë™', 'ìƒì¸ë™', 'ì›”ì•”ë™', 'ëŒ€ê³¡ë™', 'ëŒ€ì²œë™'],
            'ë‹¬ì„±êµ°': ['í™”ì›ì', 'ë…¼ê³µì', 'ë‹¤ì‚¬ì', 'ìœ ê°€ì', 'ì˜¥í¬ì', 'í˜„í’ì', 'ê°€ì°½ë©´', 'í•˜ë¹ˆë©´', 'êµ¬ì§€ë©´']
        },
        'ì¸ì²œ': {
            'ì¤‘êµ¬': ['ì¤‘ì•™ë™', 'ì‹ ìƒë™', 'ì‹ í¥ë™', 'ì„ í™”ë™', 'ë‹µë™', 'ì—°ì•ˆë™', 'í•­ë™', 'ì†¡ì›”ë™'],
            'ë™êµ¬': ['ë§Œì„ë™', 'í™”ìˆ˜ë™', 'ì†¡ë¦¼ë™', 'í™”í‰ë™', 'ê¸ˆê³¡ë™'],
            'ë¯¸ì¶”í™€êµ¬': ['ìˆ­ì˜ë™', 'ìš©í˜„ë™', 'í•™ìµë™', 'ë„í™”ë™', 'ì£¼ì•ˆë™', 'ê´€êµë™'],
            'ì—°ìˆ˜êµ¬': ['ì˜¥ë ¨ë™', 'ì„ í•™ë™', 'ì²­í•™ë™', 'ë™ì¶˜ë™', 'ì†¡ë„ë™'],
            'ë‚¨ë™êµ¬': ['êµ¬ì›”ë™', 'ê°„ì„ë™', 'ë§Œìˆ˜ë™', 'ë…¼í˜„ë™', 'ì„œì°½ë™', 'ìš´ì—°ë™', 'ë‚¨ì´Œë™', 'ì¥ìˆ˜ë™', 'ê³ ì”ë™'],
            'ë¶€í‰êµ¬': ['ë¶€í‰ë™', 'ì‚°ê³¡ë™', 'ì²­ì²œë™', 'ê°ˆì‚°ë™', 'ì‹­ì •ë™', 'ì¼ì‹ ë™'],
            'ê³„ì–‘êµ¬': ['ê³„ì‚°ë™', 'ì‘ì „ë™', 'íš¨ì„±ë™', 'ì„œìš´ë™', 'ì„í•™ë™', 'ë°•ì´Œë™', 'ìš©ì¢…ë™'],
            'ì„œêµ¬': ['ê²€ë‹¨ë™', 'ê°€ì •ë™', 'ì‹ í˜„ë™', 'ì„ë‚¨ë™', 'ê°€ì¢Œë™', 'ê²€ì•”ë™', 'ê²½ì„œë™', 'ê³µì´Œë™', 'ì—°í¬ë™', 'ì‹¬ê³¡ë™']
        },
        'ê´‘ì£¼': {
            'ë™êµ¬': ['ê¸ˆë‚¨ë¡œ', 'ì¶©ì¥ë¡œ', 'ê³„ë¦¼ë™', 'ì‚°ìˆ˜ë™', 'ì§€ì‚°ë™', 'í•™ë™', 'ëŒ€ì¸ë™', 'ë‚¨ë™'],
            'ì„œêµ¬': ['í™”ì •ë™', 'ì¹˜í‰ë™', 'ê´‘ì²œë™', 'ë†ì„±ë™', 'ì–‘ë™', 'ìƒë¬´ë™'],
            'ë‚¨êµ¬': ['ë´‰ì„ ë™', 'ì£¼ì›”ë™', 'ì†¡ì•”ë™', 'ì§„ì›”ë™', 'ë•ë‚¨ë™', 'ì–‘ë¦¼ë™', 'ë°©ë¦¼ë™', 'ì‚¬ë™', 'ì›”ì‚°ë™', 'ëŒ€ì´Œë™'],
            'ë¶êµ¬': ['ì¤‘í¥ë™', 'ìš©ë´‰ë™', 'í’í–¥ë™', 'ë¬¸í¥ë™', 'ìš´ì•”ë™', 'ì‹ ì•ˆë™', 'ë‘ì•”ë™', 'ì˜¤ì¹˜ë™', 'ì‚¼ê°ë™', 'ë§¤ê³¡ë™'],
            'ê´‘ì‚°êµ¬': ['ì†¡ì •ë™', 'ë„ì‚°ë™', 'ì‹ ê°€ë™', 'ìš°ì‚°ë™', 'í‰ë™', 'ë¹„ì•„ë™', 'ì›”ê³¡ë™', 'ì²¨ë‹¨ë™', 'í•˜ë‚¨ë™', 'ì‚°ì›”ë™']
        },
        'ëŒ€ì „': {
            'ë™êµ¬': ['ì¤‘ì•™ë™', 'ì‹ ì¸ë™', 'íŒì•”ë™', 'ìš©ìš´ë™', 'íš¨ë™', 'ê°€ì–‘ë™', 'ìì–‘ë™', 'ëŒ€ë™', 'ì‚¼ì„±ë™', 'í™ë„ë™'],
            'ì¤‘êµ¬': ['ì€í–‰ë™', 'ì„ í™”ë™', 'ëŒ€í¥ë™', 'ë¬¸í™”ë™', 'ì„êµë™', 'ëŒ€ì‚¬ë™', 'ë¶€ì‚¬ë™', 'ìš©ë‘ë™', 'ì˜¤ë¥˜ë™', 'íƒœí‰ë™'],
            'ì„œêµ¬': ['ë‘”ì‚°ë™', 'ì›”í‰ë™', 'íƒ„ë°©ë™', 'ê°ˆë§ˆë™', 'ìš©ë¬¸ë™', 'ë³µìˆ˜ë™', 'ë„ë§ˆë™', 'ë³€ë™', 'ê¸°ì„±ë™', 'ê°€ìˆ˜ì›ë™'],
            'ìœ ì„±êµ¬': ['ì§„ì ë™', 'í•™í•˜ë™', 'ì›ì‹ í¥ë™', 'ì˜¨ì²œë™', 'ë…¸ì€ë™', 'ì‹ ì„±ë™', 'ì „ë¯¼ë™', 'êµ¬ì¦‰ë™', 'ê´€í‰ë™', 'ì¥ëŒ€ë™'],
            'ëŒ€ë•êµ¬': ['ì˜¤ì •ë™', 'ëŒ€í™”ë™', 'íšŒë•ë™', 'ì¤‘ë¦¬ë™', 'ë²•ë™', 'ì‹ íƒ„ì§„ë™', 'ì„ë´‰ë™', 'ë¹„ë˜ë™']
        },
        'ìš¸ì‚°': {
            'ì¤‘êµ¬': ['ì„±ë‚¨ë™', 'ë³µì‚°ë™', 'ìš°ì •ë™', 'í•™ì„±ë™', 'ë°˜êµ¬ë™', 'íƒœí™”ë™'],
            'ë‚¨êµ¬': ['ì‚¼ì‚°ë™', 'ì‹ ì •ë™', 'ì˜¥ë™', 'ë¬´ê±°ë™', 'ë‹¬ë™', 'ì•¼ìŒë™', 'ì¥ìƒí¬ë™'],
            'ë™êµ¬': ['í™”ì •ë™', 'ì¼ì‚°ë™', 'ì „í•˜ë™', 'ëŒ€ì†¡ë™', 'ë°©ì–´ë™', 'ë‚¨ëª©ë™'],
            'ë¶êµ¬': ['ë†ì†Œë™', 'ì—°ì•”ë™', 'ì†¡ì •ë™', 'ê°•ë™', 'íš¨ë¬¸ë™', 'ì²œê³¡ë™'],
            'ìš¸ì£¼êµ°': ['ì–¸ì–‘ì', 'ì˜¨ì–‘ì', 'ì˜¨ì‚°ì', 'ì²­ëŸ‰ì', 'ë²”ì„œì', 'ë‘ë™ë©´', 'ë‘ì„œë©´', 'ìƒë¶ë©´', 'ì‚¼ë‚¨ë©´', 'ì‚¼ë™ë©´', 'ì„œìƒë©´']
        },
        'ì œì£¼': {
            'ì œì£¼ì‹œ': ['ì¼ë„ë™', 'ì´ë„ë™', 'ì‚¼ë„ë™', 'ìš©ë‹´ë™', 'ê±´ì…ë™', 'í™”ë¶ë™', 'ì‚¼ì–‘ë™', 'ë´‰ê°œë™', 'ì•„ë¼ë™', 'ì˜¤ë¼ë™', 'ì—°ë™', 'ë…¸í˜•ë™', 'ì™¸ë„ë™', 'ì´í˜¸ë™', 'ë„ë‘ë™'],
            'ì„œê·€í¬ì‹œ': ['ì„œê·€ë™', 'ëŒ€ë¥œë™', 'ëŒ€ì •ì', 'ë‚¨ì›ì', 'ì„±ì‚°ì', 'ì•ˆë•ë©´', 'í‘œì„ ë©´']
        }
    }
    
    # POI (Point of Interest) í‚¤ì›Œë“œ ë°ì´í„°ë² ì´ìŠ¤
    POI_KEYWORDS = {
        # ì„œìš¸ ë§ˆê³¡
        'ë§ˆê³¡': ['ë§ˆê³¡ë‚˜ë£¨ì—­', 'LGì‚¬ì´ì–¸ìŠ¤íŒŒí¬', 'LG ì‚¬ì´ì–¸ìŠ¤íŒŒí¬', 'ë§ˆê³¡ì¤‘ì•™ë¡œ', 'ë§ˆê³¡ì§€êµ¬', 'ë§ˆê³¡ ì„¼íŠ¸ëŸ´íŒŒí¬', 'ë§ˆê³¡ì—­'],
        
        # ì„œìš¸ ê°•ë‚¨
        'ê°•ë‚¨': ['ê°•ë‚¨ì—­', 'í…Œí—¤ë€ë¡œ', 'ì—­ì‚¼ì—­', 'ì‚¼ì„±ì—­', 'ì„ ë¦‰ì—­', 'ë…¼í˜„ì—­', 'ì‹ ë…¼í˜„ì—­', 'ì–¸ì£¼ì—­', 'ì‚¼ì„±ë™', 'ì½”ì—‘ìŠ¤', 'COEX'],
        
        # ì„œìš¸ í™ëŒ€
        'í™ëŒ€': ['í™ëŒ€ì…êµ¬ì—­', 'í™ëŒ€ê±°ë¦¬', 'ì—°ë‚¨ë™', 'ìƒìˆ˜ì—­', 'í•©ì •ì—­', 'í™ìµëŒ€í•™êµ', 'ê²½ì˜ì„ ìˆ²ê¸¸', 'í™ëŒ€í´ëŸ½ê±°ë¦¬'],
        
        # ì„œìš¸ ì—¬ì˜ë„
        'ì—¬ì˜ë„': ['ì—¬ì˜ë„ì—­', 'êµ­íšŒì˜ì‚¬ë‹¹ì—­', 'ì—¬ì˜ë‚˜ë£¨ì—­', '63ë¹Œë”©', 'IFCëª°', 'ì—¬ì˜ë„ê³µì›', 'í•œê°•ê³µì›', 'ë”í˜„ëŒ€ì„œìš¸'],
        
        # ì„œìš¸ ëª…ë™
        'ëª…ë™': ['ëª…ë™ì—­', 'ëª…ë™ê±°ë¦¬', 'ëª…ë™ì„±ë‹¹', 'ë‚¨ëŒ€ë¬¸ì‹œì¥', 'ì„ì§€ë¡œì…êµ¬ì—­', 'ì¶©ë¬´ë¡œì—­'],
        
        # ì„œìš¸ ê°•ë¶
        'ì¢…ë¡œ': ['ì¢…ê°ì—­', 'ì¢…ë¡œ3ê°€ì—­', 'ê´‘í™”ë¬¸', 'ê²½ë³µê¶', 'ë¶ì´Œí•œì˜¥ë§ˆì„', 'ì¸ì‚¬ë™', 'ì‚¼ì²­ë™'],
        
        # ì„œìš¸ ì‹ ì´Œ/ì´ëŒ€
        'ì‹ ì´Œ': ['ì‹ ì´Œì—­', 'ì´ëŒ€ì—­', 'ì´í™”ì—¬ëŒ€', 'ì—°ì„¸ëŒ€í•™êµ', 'ì‹ ì´Œë¡œí„°ë¦¬'],
        
        # ì„œìš¸ ì ì‹¤
        'ì ì‹¤': ['ì ì‹¤ì—­', 'ì ì‹¤ìƒˆë‚´ì—­', 'ë¡¯ë°ì›”ë“œ', 'ë¡¯ë°ì›”ë“œíƒ€ì›Œ', 'ì„ì´Œí˜¸ìˆ˜', 'ì˜¬ë¦¼í”½ê³µì›'],
        
        # ë¶€ì‚° í•´ìš´ëŒ€
        'í•´ìš´ëŒ€': ['í•´ìš´ëŒ€ì—­', 'í•´ìš´ëŒ€í•´ìˆ˜ìš•ì¥', 'í•´ìš´ëŒ€ë¹„ì¹˜', 'ë™ë°±ì„¬', 'ë§ˆë¦°ì‹œí‹°', 'ì„¼í…€ì‹œí‹°', 'ì‹ ì„¸ê³„ë°±í™”ì '],
        
        # ë¶€ì‚° ì„œë©´
        'ì„œë©´': ['ì„œë©´ì—­', 'ì „í¬ì¹´í˜ê±°ë¦¬', 'ë¡¯ë°ë°±í™”ì ', 'ì„œë©´ë¡œí„°ë¦¬'],
        
        # ë¶€ì‚° ê´‘ì•ˆë¦¬
        'ê´‘ì•ˆë¦¬': ['ê´‘ì•ˆë¦¬í•´ìˆ˜ìš•ì¥', 'ê´‘ì•ˆëŒ€êµ', 'ë¯¼ë½ë™', 'ìˆ˜ë³€ê³µì›'],
        
        # ëŒ€êµ¬ ë™ì„±ë¡œ
        'ë™ì„±ë¡œ': ['ì¤‘ì•™ë¡œì—­', 'ë°˜ì›”ë‹¹ì—­', 'ë™ì„±ë¡œê±°ë¦¬', 'ëŒ€êµ¬ë°±í™”ì '],
        
        # ì¸ì²œ ì†¡ë„
        'ì†¡ë„': ['ì„¼íŠ¸ëŸ´íŒŒí¬', 'ì†¡ë„êµ­ì œë„ì‹œ', 'ì†¡ë„ì»¨ë²¤ì‹œì•„', 'íŠ¸ë¦¬í”ŒìŠ¤íŠ¸ë¦¬íŠ¸'],
        
        # ì œì£¼
        'ì œì£¼': ['ì œì£¼ê³µí•­', 'ì´í˜¸í…Œìš°í•´ë³€', 'ìš©ë‘ì•”', 'ë™ë¬¸ì‹œì¥', 'í•œë¼ì‚°', 'ì„±ì‚°ì¼ì¶œë´‰', 'ìš°ë„', 'ì„­ì§€ì½”ì§€']
    }
    
    # ì»¨í…ìŠ¤íŠ¸ í‚¤ì›Œë“œ íŒ¨í„´
    CONTEXT_PATTERNS = {
        'ì‹œê°„ëŒ€': {
            'ì•„ì¹¨': ['ì•„ì¹¨', 'ëª¨ë‹', 'ì¡°ì‹', 'ë¸ŒëŸ°ì¹˜'],
            'ì ì‹¬': ['ì ì‹¬', 'ëŸ°ì¹˜', 'ì¤‘ì‹', 'ë‚®'],
            'ì €ë…': ['ì €ë…', 'ë””ë„ˆ', 'ì„ì‹'],
            'ì•¼ì‹': ['ì•¼ì‹', 'ë°¤', 'ì‹¬ì•¼', 'ìƒˆë²½']
        },
        'íƒ€ê²Ÿ': {
            'ì§ì¥ì¸': ['ì§ì¥ì¸', 'íšŒì‚¬ì›', 'ì˜¤í”¼ìŠ¤', 'ì›Œì»¤', 'IT', 'ì—…ë¬´', 'ë¹„ì¦ˆë‹ˆìŠ¤'],
            'í•™ìƒ': ['í•™ìƒ', 'ëŒ€í•™ìƒ', 'ê³ ë“±í•™ìƒ', 'ì²­ì†Œë…„'],
            'ê°€ì¡±': ['ê°€ì¡±', 'ì•„ì´', 'ì–´ë¦°ì´', 'ìœ ì•„', 'í‚¤ì¦ˆ'],
            'ë°ì´íŠ¸': ['ë°ì´íŠ¸', 'ì—°ì¸', 'ì»¤í”Œ', 'ì• ì¸'],
            'í˜¼ì': ['í˜¼ì', 'í˜¼ë°¥', 'í˜¼ìˆ ', '1ì¸']
        },
        'ëª©ì ': {
            'íšŒì˜': ['íšŒì˜', 'ë¯¸íŒ…', 'ì„¸ë¯¸ë‚˜', 'ì»¨í¼ëŸ°ìŠ¤'],
            'ëª¨ì„': ['ëª¨ì„', 'ì•½ì†', 'ìˆ ìë¦¬', 'íšŒì‹'],
            'ì‚°ì±…': ['ì‚°ì±…', 'ê±·ê¸°', 'ì¡°ê¹…', 'ìš´ë™'],
            'ì‡¼í•‘': ['ì‡¼í•‘', 'êµ¬ê²½', 'êµ¬ë§¤']
        }
    }
    
    def extract_location_hierarchy(self, prompt: str) -> Dict[str, Any]:
        """
        í”„ë¡¬í”„íŠ¸ì—ì„œ ê³„ì¸µì  ì§€ì—­ ì •ë³´ ì¶”ì¶œ
        
        Args:
            prompt: ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ (ì˜ˆ: "ì„œìš¸ ë§ˆê³¡ LGì‚¬ì´ì–¸ìŠ¤íŒŒí¬ ê·¼ì²˜ IT ì§ì¥ì¸ ì ì‹¬ ë§›ì§‘")
        
        Returns:
            {
                'city': 'ì„œìš¸',
                'district': 'ê°•ì„œêµ¬',
                'neighborhood': 'ë§ˆê³¡ë™',
                'poi': ['LGì‚¬ì´ì–¸ìŠ¤íŒŒí¬', 'ë§ˆê³¡ë‚˜ë£¨ì—­'],
                'context': {
                    'ì‹œê°„ëŒ€': ['ì ì‹¬'],
                    'íƒ€ê²Ÿ': ['ì§ì¥ì¸', 'IT'],
                    'ëª©ì ': []
                },
                'search_radius_km': 1.0,
                'lat': 37.5614,
                'lng': 126.8279,
                'location_specificity': 'high'  # high/medium/low
            }
        """
        result = {
            'city': None,
            'district': None,
            'neighborhood': None,
            'poi': [],
            'context': {
                'ì‹œê°„ëŒ€': [],
                'íƒ€ê²Ÿ': [],
                'ëª©ì ': []
            },
            'search_radius_km': 3.0,  # ê¸°ë³¸ê°’: ë„ì‹œ ë ˆë²¨
            'lat': None,
            'lng': None,
            'location_specificity': 'low'
        }
        
        # 1. ë„ì‹œ ì¶”ì¶œ
        for city in self.KOREAN_LOCATIONS.keys():
            if city in prompt:
                result['city'] = city
                break
        
        if not result['city']:
            # ë„ì‹œê°€ ëª…ì‹œë˜ì§€ ì•Šì€ ê²½ìš° ê¸°ë³¸ê°’ ì„œìš¸
            result['city'] = 'ì„œìš¸'
        
        # 2. ë™(neighborhood) ì¶”ì¶œ (ìš°ì„  ì²˜ë¦¬)
        if result['city']:
            for district, neighborhoods in self.KOREAN_LOCATIONS[result['city']].items():
                for neighborhood in neighborhoods:
                    if neighborhood in prompt:
                        result['neighborhood'] = neighborhood
                        result['district'] = district
                        result['search_radius_km'] = 1.0  # ë™ ë ˆë²¨: ì¢ì€ ë°˜ê²½
                        result['location_specificity'] = 'high'
                        print(f"âœ… ë™ ë ˆë²¨ ê°ì§€: {result['city']} {result['district']} {result['neighborhood']}")
                        break
                if result['neighborhood']:
                    break
        
        # 3. êµ¬(district) ì¶”ì¶œ (ë™ì´ ì—†ì„ ë•Œë§Œ)
        if result['city'] and not result['district']:
            for district in self.KOREAN_LOCATIONS[result['city']].keys():
                if district in prompt:
                    result['district'] = district
                    result['search_radius_km'] = 2.0  # êµ¬ ë ˆë²¨: ì¤‘ê°„ ë°˜ê²½
                    result['location_specificity'] = 'medium'
                    print(f"âœ… êµ¬ ë ˆë²¨ ê°ì§€: {result['city']} {result['district']}")
                    break
        
        # 4. POI ì¶”ì¶œ (ê°€ì¥ êµ¬ì²´ì )
        for poi_area, poi_list in self.POI_KEYWORDS.items():
            for poi in poi_list:
                if poi.lower() in prompt.lower():
                    result['poi'].append(poi)
                    result['search_radius_km'] = 0.5  # POI ë ˆë²¨: ë§¤ìš° ì¢ì€ ë°˜ê²½
                    result['location_specificity'] = 'very_high'
                    print(f"âœ… POI ê°ì§€: {poi}")
        
        # ì¤‘ë³µ ì œê±°
        result['poi'] = list(set(result['poi']))
        
        # 5. ì»¨í…ìŠ¤íŠ¸ ì¶”ì¶œ
        for context_type, patterns_dict in self.CONTEXT_PATTERNS.items():
            for context_name, patterns in patterns_dict.items():
                for pattern in patterns:
                    if pattern.lower() in prompt.lower():
                        result['context'][context_type].append(context_name)
        
        # ì¤‘ë³µ ì œê±°
        for context_type in result['context']:
            result['context'][context_type] = list(set(result['context'][context_type]))
        
        # 6. ì¢Œí‘œ ë³€í™˜
        result['lat'], result['lng'] = self._get_coordinates(
            result['city'], 
            result['district'], 
            result['neighborhood'],
            result['poi']
        )
        
        # 7. ê²€ìƒ‰ ì¿¼ë¦¬ ìƒì„±ìš© í…ìŠ¤íŠ¸
        result['location_text'] = self._build_location_text(result)
        
        print(f"\nğŸ“ ì§€ì—­ ê³„ì¸µ ì¶”ì¶œ ê²°ê³¼:")
        print(f"   ë„ì‹œ: {result['city']}")
        print(f"   êµ¬: {result['district']}")
        print(f"   ë™: {result['neighborhood']}")
        print(f"   POI: {result['poi']}")
        print(f"   ì»¨í…ìŠ¤íŠ¸: {result['context']}")
        print(f"   ê²€ìƒ‰ ë°˜ê²½: {result['search_radius_km']}km")
        print(f"   ìœ„ì¹˜ ì •ë°€ë„: {result['location_specificity']}")
        print(f"   ì¢Œí‘œ: ({result['lat']}, {result['lng']})")
        
        return result
    
    def _get_coordinates(
        self, 
        city: Optional[str], 
        district: Optional[str], 
        neighborhood: Optional[str],
        pois: List[str]
    ) -> Tuple[float, float]:
        """
        ì§€ì—­ ì •ë³´ë¥¼ ìœ„ê²½ë„ ì¢Œí‘œë¡œ ë³€í™˜
        
        ìš°ì„ ìˆœìœ„: POI > ë™ > êµ¬ > ë„ì‹œ
        """
        # POI ì¢Œí‘œ ë°ì´í„°ë² ì´ìŠ¤ (ì£¼ìš” ëœë“œë§ˆí¬)
        POI_COORDINATES = {
            'LGì‚¬ì´ì–¸ìŠ¤íŒŒí¬': (37.5614, 126.8279),
            'LG ì‚¬ì´ì–¸ìŠ¤íŒŒí¬': (37.5614, 126.8279),
            'ë§ˆê³¡ë‚˜ë£¨ì—­': (37.5605, 126.8251),
            'ë§ˆê³¡ì—­': (37.5602, 126.8255),
            'ê°•ë‚¨ì—­': (37.4981, 127.0276),
            'í…Œí—¤ë€ë¡œ': (37.5009, 127.0359),
            'COEX': (37.5130, 127.0592),
            'ì½”ì—‘ìŠ¤': (37.5130, 127.0592),
            'í™ëŒ€ì…êµ¬ì—­': (37.5571, 126.9245),
            'ì—¬ì˜ë„ì—­': (37.5219, 126.9245),
            'IFCëª°': (37.5251, 126.9261),
            'ëª…ë™ì—­': (37.5610, 126.9865),
            'í•´ìš´ëŒ€í•´ìˆ˜ìš•ì¥': (35.1631, 129.1635),
            'ì„¼í…€ì‹œí‹°': (35.1694, 129.1308)
        }
        
        # 1. POIê°€ ìˆìœ¼ë©´ POI ì¢Œí‘œ ìš°ì„ 
        if pois:
            for poi in pois:
                if poi in POI_COORDINATES:
                    print(f"   ì¢Œí‘œ ì¶œì²˜: POI ({poi})")
                    return POI_COORDINATES[poi]
        
        # 2. ë™ ì¢Œí‘œ (í•˜ë“œì½”ë”©ëœ ì£¼ìš” ë™ë§Œ í¬í•¨)
        NEIGHBORHOOD_COORDINATES = {
            ('ì„œìš¸', 'ê°•ì„œêµ¬', 'ë§ˆê³¡ë™'): (37.5614, 126.8279),
            ('ì„œìš¸', 'ê°•ë‚¨êµ¬', 'ì—­ì‚¼ë™'): (37.5009, 127.0359),
            ('ì„œìš¸', 'ê°•ë‚¨êµ¬', 'ì‚¼ì„±ë™'): (37.5140, 127.0630),
            ('ì„œìš¸', 'ê°•ë‚¨êµ¬', 'ì²­ë‹´ë™'): (37.5196, 127.0476),
            ('ì„œìš¸', 'ë§ˆí¬êµ¬', 'ì„œêµë™'): (37.5571, 126.9245),  # í™ëŒ€
            ('ì„œìš¸', 'ë§ˆí¬êµ¬', 'ì—°ë‚¨ë™'): (37.5667, 126.9245),
            ('ì„œìš¸', 'ì˜ë“±í¬êµ¬', 'ì—¬ì˜ë„ë™'): (37.5219, 126.9245),
            ('ì„œìš¸', 'ì¤‘êµ¬', 'ëª…ë™'): (37.5610, 126.9865),
            ('ì„œìš¸', 'ì¢…ë¡œêµ¬', 'ì¢…ë¡œ1ê°€'): (37.5701, 126.9828),
            ('ì„œìš¸', 'ì†¡íŒŒêµ¬', 'ì ì‹¤ë™'): (37.5130, 127.1021),
            ('ë¶€ì‚°', 'í•´ìš´ëŒ€êµ¬', 'ìš°ë™'): (35.1631, 129.1635),
            ('ë¶€ì‚°', 'ë¶€ì‚°ì§„êµ¬', 'ë¶€ì „ë™'): (35.1561, 129.0601),
            ('ë¶€ì‚°', 'ìˆ˜ì˜êµ¬', 'ê´‘ì•ˆë™'): (35.1537, 129.1188),
            ('ëŒ€êµ¬', 'ì¤‘êµ¬', 'ë™ì¸ë™'): (35.8714, 128.6014)
        }
        
        if neighborhood:
            key = (city, district, neighborhood)
            if key in NEIGHBORHOOD_COORDINATES:
                print(f"   ì¢Œí‘œ ì¶œì²˜: ë™ ({neighborhood})")
                return NEIGHBORHOOD_COORDINATES[key]
        
        # 3. êµ¬ ì¢Œí‘œ
        DISTRICT_COORDINATES = {
            ('ì„œìš¸', 'ê°•ì„œêµ¬'): (37.5509, 126.8495),
            ('ì„œìš¸', 'ê°•ë‚¨êµ¬'): (37.5172, 127.0473),
            ('ì„œìš¸', 'ì¢…ë¡œêµ¬'): (37.5735, 126.9788),
            ('ì„œìš¸', 'ì¤‘êµ¬'): (37.5641, 126.9979),
            ('ì„œìš¸', 'ë§ˆí¬êµ¬'): (37.5663, 126.9019),
            ('ì„œìš¸', 'ì˜ë“±í¬êµ¬'): (37.5264, 126.8963),
            ('ì„œìš¸', 'ì†¡íŒŒêµ¬'): (37.5145, 127.1059),
            ('ë¶€ì‚°', 'í•´ìš´ëŒ€êµ¬'): (35.1631, 129.1635),
            ('ë¶€ì‚°', 'ë¶€ì‚°ì§„êµ¬'): (35.1628, 129.0537),
            ('ë¶€ì‚°', 'ì¤‘êµ¬'): (35.1013, 129.0320),
            ('ëŒ€êµ¬', 'ì¤‘êµ¬'): (35.8714, 128.6014),
            ('ëŒ€êµ¬', 'ìˆ˜ì„±êµ¬'): (35.8581, 128.6308)
        }
        
        if district:
            key = (city, district)
            if key in DISTRICT_COORDINATES:
                print(f"   ì¢Œí‘œ ì¶œì²˜: êµ¬ ({district})")
                return DISTRICT_COORDINATES[key]
        
        # 4. ë„ì‹œ ì¢Œí‘œ (ê¸°ë³¸ê°’)
        CITY_COORDINATES = {
            'ì„œìš¸': (37.5665, 126.9780),
            'ë¶€ì‚°': (35.1796, 129.0756),
            'ëŒ€êµ¬': (35.8714, 128.6014),
            'ì¸ì²œ': (37.4563, 126.7052),
            'ê´‘ì£¼': (35.1595, 126.8526),
            'ëŒ€ì „': (36.3504, 127.3845),
            'ìš¸ì‚°': (35.5384, 129.3114),
            'ì œì£¼': (33.4996, 126.5312)
        }
        
        if city and city in CITY_COORDINATES:
            print(f"   ì¢Œí‘œ ì¶œì²˜: ë„ì‹œ ({city})")
            return CITY_COORDINATES[city]
        
        # ê¸°ë³¸ê°’: ì„œìš¸
        print(f"   ì¢Œí‘œ ì¶œì²˜: ê¸°ë³¸ê°’ (ì„œìš¸)")
        return (37.5665, 126.9780)
    
    def _build_location_text(self, location_hierarchy: Dict) -> str:
        """ê²€ìƒ‰ ì¿¼ë¦¬ìš© ìœ„ì¹˜ í…ìŠ¤íŠ¸ ìƒì„±"""
        parts = []
        
        if location_hierarchy['city']:
            parts.append(location_hierarchy['city'])
        
        if location_hierarchy['district']:
            parts.append(location_hierarchy['district'])
        
        if location_hierarchy['neighborhood']:
            parts.append(location_hierarchy['neighborhood'])
        
        if location_hierarchy['poi']:
            parts.extend(location_hierarchy['poi'][:2])  # ìµœëŒ€ 2ê°œ POI
        
        return ' '.join(parts)

