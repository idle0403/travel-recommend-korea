<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🇰🇷 스마트 한국 여행 플래너</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🇰🇷</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="flex justify-between items-center mb-4">
                <div></div>
                <div id="authButtons" class="space-x-2">
                    <a href="login.html" class="px-4 py-2 text-blue-600 border border-blue-600 rounded hover:bg-blue-50">로그인</a>
                    <a href="register.html" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">회원가입</a>
                </div>
                <div id="userInfo" class="hidden space-x-2">
                    <a href="history.html" class="px-4 py-2 text-blue-600 border border-blue-600 rounded hover:bg-blue-50">
                        <i class="fas fa-history mr-1"></i>내 여행
                    </a>
                    <span id="userName" class="text-gray-700"></span>
                    <button id="logoutBtn" class="px-4 py-2 text-red-600 border border-red-600 rounded hover:bg-red-50">로그아웃</button>
                </div>
            </div>
            <h1 class="text-4xl font-bold text-gray-800 mb-2">🇰🇷 스마트 한국 여행 플래너</h1>
            <p class="text-gray-600">AI가 추천하는 맞춤형 한국 여행 계획</p>
        </div>

        <!-- Main Form -->
        <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6 mb-8">
            <form id="travelForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-map-marker-alt text-red-500"></i> 여행 도시
                        </label>
                        <select id="city" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <optgroup label="특별시">
                                <option value="Seoul">서울특별시</option>
                            </optgroup>
                            <optgroup label="광역시">
                                <option value="Busan">부산광역시</option>
                                <option value="Daegu">대구광역시</option>
                                <option value="Incheon">인천광역시</option>
                                <option value="Gwangju">광주광역시</option>
                                <option value="Daejeon">대전광역시</option>
                                <option value="Ulsan">울산광역시</option>
                            </optgroup>
                            <optgroup label="특별자치도">
                                <option value="Jeju">제주특별자치도</option>
                            </optgroup>
                            <optgroup label="경기도">
                                <option value="Suwon">수원시</option>
                                <option value="Yongin">용인시</option>
                                <option value="Seongnam">성남시</option>
                                <option value="Goyang">고양시</option>
                            </optgroup>
                            <optgroup label="강원도">
                                <option value="Chuncheon">춘천시</option>
                                <option value="Gangneung">강릉시</option>
                                <option value="Sokcho">속초시</option>
                            </optgroup>
                            <optgroup label="충청북도">
                                <option value="Cheongju">청주시</option>
                                <option value="Chungju">충주시</option>
                            </optgroup>
                            <optgroup label="충청남도">
                                <option value="Cheonan">천안시</option>
                                <option value="Gongju">공주시</option>
                                <option value="Buyeo">부여군</option>
                            </optgroup>
                            <optgroup label="전라북도">
                                <option value="Jeonju">전주시</option>
                                <option value="Gunsan">군산시</option>
                            </optgroup>
                            <optgroup label="전라남도">
                                <option value="Mokpo">목포시</option>
                                <option value="Yeosu">여수시</option>
                                <option value="Suncheon">순천시</option>
                            </optgroup>
                            <optgroup label="경상북도">
                                <option value="Pohang">포항시</option>
                                <option value="Gyeongju">경주시</option>
                                <option value="Andong">안동시</option>
                            </optgroup>
                            <optgroup label="경상남도">
                                <option value="Changwon">창원시</option>
                                <option value="Jinju">진주시</option>
                                <option value="Tongyeong">통영시</option>
                                <option value="Geoje">거제시</option>
                            </optgroup>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-heart text-pink-500"></i> 여행 스타일
                        </label>
                        <select id="travelStyle" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="indoor_date">💕 실내 데이트</option>
                            <option value="outdoor_date">🌳 실외 데이트</option>
                            <option value="food_tour">🍽️ 맛집 투어</option>
                            <option value="culture_tour">🏛️ 문화 탐방</option>
                            <option value="shopping_tour">🛍️ 쇼핑 투어</option>
                            <option value="healing_tour">🧘 힐링 여행</option>
                            <option value="adventure_tour">🎢 액티비티</option>
                            <option value="night_tour">🌃 야경 투어</option>
                            <option value="family_tour">👨‍👩‍👧‍👦 가족 여행</option>
                            <option value="custom">✨ 맞춤 설정</option>
                        </select>
                    </div>
                </div>

                <!-- 여행 기간 설정 -->
                <div id="customDateSection" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-calendar-plus text-green-500"></i> 여행 시작
                            </label>
                            <div class="grid grid-cols-2 gap-2">
                                <input type="date" id="startDate" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <input type="time" id="startTime" value="09:00" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-calendar-minus text-red-500"></i> 여행 종료
                            </label>
                            <div class="grid grid-cols-2 gap-2">
                                <input type="date" id="endDate" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <input type="time" id="endTime" value="18:00" class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>
                    
                    <!-- 여행 기간 표시 -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-info-circle text-blue-500"></i>
                            <span class="text-sm font-medium text-blue-800">여행 기간:</span>
                            <span id="tripDuration" class="text-sm text-blue-700">날짜를 선택해주세요</span>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-home text-orange-500"></i> 출발지 (집 주소)</span>
                    </label>
                    <div class="relative">
                        <input type="text" id="startLocation" placeholder="지도에서 출발지를 선택해주세요"
                               class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 cursor-pointer focus:ring-2 focus:ring-blue-500" readonly>
                        <button type="button" id="mapSearchBtn" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-blue-500 hover:text-blue-700">
                            <i class="fas fa-map-marker-alt"></i>
                        </button>
                    </div>

                </div>

                <!-- 지도 선택 모달 -->
                <div id="mapModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
                    <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-96">
                        <div class="p-4">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-bold text-gray-800">출발지 선택</h3>
                                <button id="closeMapModal" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="mb-3">
                                <input type="text" id="mapSearchInput" placeholder="주소나 장소명 검색"
                                       class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div id="mapContainer" class="w-full h-80 rounded border"></div>
                            <div class="mt-3 flex justify-end space-x-2">
                                <button id="cancelMapSelection" class="px-4 py-2 text-gray-600 border rounded hover:bg-gray-50">취소</button>
                                <button id="confirmMapSelection" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">선택 완료</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-comment text-green-500"></i> 여행 요청사항
                    </label>
                    <textarea id="prompt" rows="4" placeholder="예: 맛집 위주로 가족 여행 계획을 세워주세요"
                              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                </div>

                <button type="submit" id="submitBtn"
                        class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-3 px-6 rounded-lg hover:from-blue-600 hover:to-indigo-700 transition duration-300">
                    <i class="fas fa-magic mr-2"></i>
                    <span id="btnText">AI 여행 계획 생성</span>
                </button>
            </form>
        </div>

        <!-- Loading -->
        <div id="loading" class="hidden text-center py-8">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
            <p class="mt-4 text-gray-600">AI가 맞춤형 여행 계획을 생성하고 있습니다...</p>
        </div>

        <!-- Results -->
        <div id="results" class="hidden max-w-7xl mx-auto">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Left Column: Timeline & Details -->
                <div class="space-y-6">
                    <!-- Timeline -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-clock text-blue-500"></i> 시간별 일정
                        </h2>
                        <!-- 일자별 탭 -->
                        <div id="dayTabs" class="flex flex-wrap mb-4 border-b hidden"></div>
                        <div id="timeline" class="space-y-4"></div>
                    </div>

                    <!-- Place Details -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            <i class="fas fa-info-circle text-green-500"></i> 장소 상세정보
                        </h3>
                        <div id="placeDetails" class="space-y-4"></div>
                    </div>
                </div>

                <!-- Right Column: Map & Status -->
                <div class="space-y-6">
                    <!-- Map -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            <i class="fas fa-map text-red-500"></i> 최적 동선
                        </h3>
                        <div class="mb-3 flex space-x-4 text-xs">
                            <div class="flex items-center">
                                <div class="w-4 h-1 bg-blue-500 mr-1"></div>
                                <span>🚇 대중교통</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-1 bg-red-500 mr-1"></div>
                                <span>🚗 자동차</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-1 bg-green-500 mr-1"></div>
                                <span>🚶 도보</span>
                            </div>
                        </div>
                        <div id="map" class="w-full h-96 rounded-lg"></div>
                        
                        <!-- 경로 선택 버튼 영역 -->
                        <div id="routeSection" class="mt-4 hidden">
                            <div class="border-t pt-4">
                                <h4 class="font-semibold text-gray-700 mb-3">🚗 경로 선택</h4>
                                <div id="routeButtons"></div>
                                <div id="routeDetails" class="mt-3 text-sm text-gray-600"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Weather Info -->
                    <div id="weatherInfo" class="bg-white rounded-lg shadow-lg p-6 hidden">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">
                            <i class="fas fa-cloud-sun text-blue-500"></i> 현재 날씨
                        </h3>
                        <div id="weatherContent" class="space-y-2"></div>
                    </div>

                    <!-- 여행 계획 저장 -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">
                            <i class="fas fa-save text-green-500"></i> 여행 계획 저장
                        </h3>
                        <div class="space-y-3">
                            <button id="savePlanBtn" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600">
                                <i class="fas fa-bookmark mr-2"></i>내 여행 계획에 저장
                            </button>
                            <button id="saveNotionBtn" class="w-full bg-purple-500 text-white py-2 rounded hover:bg-purple-600">
                                <i class="fas fa-database mr-2"></i>Notion에 저장
                            </button>
                        </div>
                        <div id="saveResult" class="mt-3 hidden"></div>
                    </div>
                    
                    <!-- 예산 계산기 -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">
                            <i class="fas fa-calculator text-orange-500"></i> 예산 계산
                        </h3>
                        <div class="space-y-2">
                            <select id="budgetStyle" class="w-full p-2 border rounded">
                                <option value="budget">절약형</option>
                                <option value="moderate" selected>보통</option>
                                <option value="luxury">럭셔리</option>
                            </select>
                            <button id="calculateBudgetBtn" class="w-full bg-orange-500 text-white py-2 rounded hover:bg-orange-600">
                                예산 계산하기
                            </button>
                        </div>
                        <div id="budgetResult" class="mt-3 hidden"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div id="toast" class="fixed top-4 right-4 z-50 hidden">
            <div class="bg-white border-l-4 border-green-500 rounded-lg shadow-lg p-4 max-w-sm">
                <div class="flex items-center">
                    <i id="toastIcon" class="fas fa-check-circle text-green-500 mr-3"></i>
                    <span id="toastMessage" class="text-gray-800"></span>
                </div>
            </div>
        </div>

        <!-- Place Modal -->
        <div id="placeModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 id="modalTitle" class="text-xl font-bold text-gray-800"></h3>
                        <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div id="modalContent" class="space-y-4"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ✅ script.js를 body 끝에서 로드 -->
    <script src="script.js"></script>
    <script>
        // DOM 로드 완료 후 Google Maps API 로드
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadGoogleMaps);
        } else {
            loadGoogleMaps();
        }
        
        function loadGoogleMaps() {
            console.log('Loading Google Maps API...');
            fetch('/api/travel/config')
                .then(response => response.json())
                .then(config => {
                    console.log('Config loaded:', config);
                    const script = document.createElement('script');
                    script.src = `https://maps.googleapis.com/maps/api/js?key=${config.google_maps_api_key}&libraries=places,geometry&callback=initializeApp`;
                    script.onerror = () => console.error('Google Maps API 로드 실패');
                    document.head.appendChild(script);
                })
                .catch(error => console.error('API 키 로드 실패:', error));
        }
    </script>
</body>
</html>